"use strict";(()=>{var t={};t.id=667,t.ids=[667],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:t=>{t.exports=require("crypto")},665:t=>{t.exports=require("dns")},7702:t=>{t.exports=require("events")},2048:t=>{t.exports=require("fs")},2615:t=>{t.exports=require("http")},2694:t=>{t.exports=require("http2")},8216:t=>{t.exports=require("net")},9801:t=>{t.exports=require("os")},5315:t=>{t.exports=require("path")},5816:t=>{t.exports=require("process")},6162:t=>{t.exports=require("stream")},2452:t=>{t.exports=require("tls")},7360:t=>{t.exports=require("url")},1764:t=>{t.exports=require("util")},1568:t=>{t.exports=require("zlib")},1628:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>I,routeModule:()=>A,serverHooks:()=>E,staticGenerationAsyncStorage:()=>p});var d={};a.r(d),a.d(d,{DELETE:()=>l,GET:()=>c,PATCH:()=>S,dynamic:()=>u});var i=a(9303),r=a(8716),o=a(670),n=a(7070),s=a(7813);let u="force-dynamic";async function c(t,{params:e}){try{let t=await s.C.getAuditById(e.id);if(!t)return n.NextResponse.json({error:"Audit not found"},{status:404});let a={...t,dateStarted:t.dateStarted instanceof Date?t.dateStarted.toISOString():t.dateStarted?.toDate?.()?.toISOString(),dateCompleted:t.dateCompleted instanceof Date?t.dateCompleted.toISOString():t.dateCompleted?.toDate?.()?.toISOString(),createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt?.toDate?.()?.toISOString(),updatedAt:t.updatedAt instanceof Date?t.updatedAt.toISOString():t.updatedAt?.toDate?.()?.toISOString(),leadAuditor:t.leadAuditor?{...t.leadAuditor,createdAt:t.leadAuditor.createdAt instanceof Date?t.leadAuditor.createdAt.toISOString():t.leadAuditor.createdAt?.toDate?.()?.toISOString(),updatedAt:t.leadAuditor.updatedAt instanceof Date?t.leadAuditor.updatedAt.toISOString():t.leadAuditor.updatedAt?.toDate?.()?.toISOString()}:null,interviewees:t.interviewees?.map(t=>({...t,createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt?.toDate?.()?.toISOString(),updatedAt:t.updatedAt instanceof Date?t.updatedAt.toISOString():t.updatedAt?.toDate?.()?.toISOString()}))||[],findings:t.findings?.map(t=>({...t,timestamp:t.timestamp instanceof Date?t.timestamp.toISOString():t.timestamp?.toDate?.()?.toISOString(),createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt?.toDate?.()?.toISOString(),updatedAt:t.updatedAt instanceof Date?t.updatedAt.toISOString():t.updatedAt?.toDate?.()?.toISOString()}))||[],omittedQuestions:t.omittedQuestions?.map(t=>({...t,omittedAt:t.omittedAt instanceof Date?t.omittedAt.toISOString():t.omittedAt?.toDate?.()?.toISOString(),createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt?.toDate?.()?.toISOString(),updatedAt:t.updatedAt instanceof Date?t.updatedAt.toISOString():t.updatedAt?.toDate?.()?.toISOString()}))||[]};return n.NextResponse.json(a)}catch(t){return console.error("Failed to fetch audit:",t),n.NextResponse.json({error:"Failed to fetch audit"},{status:500})}}async function S(t,{params:e}){try{let a=await t.json();await s.C.updateAudit(e.id,a);let d=await s.C.getAuditById(e.id);if(!d)return n.NextResponse.json({error:"Audit not found"},{status:404});let i={...d,dateStarted:d.dateStarted instanceof Date?d.dateStarted.toISOString():d.dateStarted?.toDate?.()?.toISOString(),dateCompleted:d.dateCompleted instanceof Date?d.dateCompleted.toISOString():d.dateCompleted?.toDate?.()?.toISOString(),createdAt:d.createdAt instanceof Date?d.createdAt.toISOString():d.createdAt?.toDate?.()?.toISOString(),updatedAt:d.updatedAt instanceof Date?d.updatedAt.toISOString():d.updatedAt?.toDate?.()?.toISOString(),leadAuditor:d.leadAuditor?{...d.leadAuditor,createdAt:d.leadAuditor.createdAt instanceof Date?d.leadAuditor.createdAt.toISOString():d.leadAuditor.createdAt?.toDate?.()?.toISOString(),updatedAt:d.leadAuditor.updatedAt instanceof Date?d.leadAuditor.updatedAt.toISOString():d.leadAuditor.updatedAt?.toDate?.()?.toISOString()}:null,interviewees:d.interviewees?.map(t=>({...t,createdAt:t.createdAt instanceof Date?t.createdAt.toISOString():t.createdAt?.toDate?.()?.toISOString(),updatedAt:t.updatedAt instanceof Date?t.updatedAt.toISOString():t.updatedAt?.toDate?.()?.toISOString()}))||[]};return n.NextResponse.json(i)}catch(t){return console.error("Failed to update audit:",t),n.NextResponse.json({error:"Failed to update audit"},{status:500})}}async function l(t,{params:e}){try{return await s.C.deleteAudit(e.id),n.NextResponse.json({success:!0})}catch(t){return console.error("Failed to delete audit:",t),n.NextResponse.json({error:"Failed to delete audit"},{status:500})}}let A=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/audits/[id]/route",pathname:"/api/audits/[id]",filename:"route",bundlePath:"app/api/audits/[id]/route"},resolvedPagePath:"/workspaces/logosaudit/app/api/audits/[id]/route.ts",nextConfigOutput:"",userland:d}),{requestAsyncStorage:I,staticGenerationAsyncStorage:p,serverHooks:E}=A,g="/api/audits/[id]/route";function m(){return(0,o.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:p})}},7813:(t,e,a)=>{a.d(e,{C:()=>n});var d=a(2686);process.env.NEXT_PUBLIC_FIREBASE_API_KEY,process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,process.env.NEXT_PUBLIC_FIREBASE_APP_ID;let i={};class r{static async create(t,e){let a=(0,d.hJ)(i,t);return await (0,d.ET)(a,{...e,createdAt:d.EK.now(),updatedAt:d.EK.now()})}static async getById(t,e){let a=(0,d.JU)(i,t,e),r=await (0,d.QT)(a);return r.exists()?{id:r.id,...r.data()}:null}static async query(t,e=[]){let a=(0,d.hJ)(i,t),r=(0,d.IO)(a,...e);return(await (0,d.PL)(r)).docs.map(t=>({id:t.id,...t.data()}))}static async update(t,e,a){let r=(0,d.JU)(i,t,e);await (0,d.r7)(r,{...a,updatedAt:d.EK.now()})}static async delete(t,e){let a=(0,d.JU)(i,t,e);await (0,d.oe)(a)}static async getAll(t,e,a="desc"){(0,d.hJ)(i,t);let r=[];return e&&r.push((0,d.Xo)(e,a)),this.query(t,r)}static async getByField(t,e,a){return this.query(t,[(0,d.ar)(e,"==",a)])}static timestampToDate(t){return t?.toDate?t.toDate():t instanceof Date?t:new Date(t)}static dateToTimestamp(t){return d.EK.fromDate(t)}}let o={USERS:"users",AUDITS:"audits",INTERVIEWEES:"interviewees",AUDIT_FINDINGS:"auditFindings",OMITTED_QUESTIONS:"omittedQuestions"};class n{static async createAudit(t){let e=(0,d.hJ)(i,o.USERS),a=(0,d.IO)(e,(0,d.ar)("email","==",t.leadAuditorEmail)),r=await (0,d.PL)(a);return(0,d.i3)(i,async e=>{let a;if(r.empty){let r=(0,d.JU)((0,d.hJ)(i,o.USERS)),n={uid:"",email:t.leadAuditorEmail,name:t.leadAuditorName,title:t.leadAuditorTitle,createdAt:d.EK.now(),updatedAt:d.EK.now()};e.set(r,n),a={...n,id:r.id}}else{let t=r.docs[0];a={id:t.id,...t.data()}}let n=(0,d.JU)((0,d.hJ)(i,o.AUDITS)),s={title:t.title,dateStarted:d.EK.now(),status:"IN_PROGRESS",companyName:t.companyName,companyAddress:t.companyAddress,leadAuditorId:a.id,leadAuditorEmail:a.email,isoStandard:t.isoStandard,selectedSections:t.selectedSections,customScope:t.customScope,completionPercentage:0,hasDocuments:!1,createdAt:d.EK.now(),updatedAt:d.EK.now()};e.set(n,s);let u=[];for(let a of t.interviewees){let t=(0,d.JU)((0,d.hJ)(i,o.INTERVIEWEES)),r={auditId:n.id,name:a.name,jobTitle:a.jobTitle,department:a.department,email:a.email,createdAt:d.EK.now(),updatedAt:d.EK.now()};e.set(t,r),u.push({...r,id:t.id})}return{...s,id:n.id,leadAuditor:a,interviewees:u,findings:[],omittedQuestions:[],documents:[]}})}static async getAllAudits(){return Promise.all((await r.getAll(o.AUDITS,"dateStarted","desc")).map(async t=>{let[e,a,d,i]=await Promise.all([r.getById(o.USERS,t.leadAuditorId),r.getByField(o.INTERVIEWEES,"auditId",t.id),this.getAuditFindingsCount(t.id),this.getOmittedQuestionsCount(t.id)]);return{...t,leadAuditor:e,interviewees:a,_count:{findings:d,omittedQuestions:i}}}))}static async getAuditById(t){let e=await r.getById(o.AUDITS,t);if(!e)return null;let[a,d,i,n]=await Promise.all([r.getById(o.USERS,e.leadAuditorId),r.getByField(o.INTERVIEWEES,"auditId",t),r.getByField(o.AUDIT_FINDINGS,"auditId",t),r.getByField(o.OMITTED_QUESTIONS,"auditId",t)]);return{...e,leadAuditor:a,interviewees:d,findings:i,omittedQuestions:n}}static async updateAudit(t,e){await r.update(o.AUDITS,t,e)}static async deleteAudit(t){let e=(0,d.qs)(i),a=(0,d.JU)(i,o.AUDITS,t);e.delete(a);let[n,s,u]=await Promise.all([r.getByField(o.INTERVIEWEES,"auditId",t),r.getByField(o.AUDIT_FINDINGS,"auditId",t),r.getByField(o.OMITTED_QUESTIONS,"auditId",t)]);[...n,...s,...u].forEach(t=>{if(t.id){let a="auditId"in t&&"questionId"in t&&"score"in t?o.AUDIT_FINDINGS:"auditId"in t&&"questionId"in t&&"reason"in t?o.OMITTED_QUESTIONS:o.INTERVIEWEES,r=(0,d.JU)(i,a,t.id);e.delete(r)}}),await e.commit()}static async getAuditFindingsCount(t){return(await r.getByField(o.AUDIT_FINDINGS,"auditId",t)).length}static async getOmittedQuestionsCount(t){return(await r.getByField(o.OMITTED_QUESTIONS,"auditId",t)).length}static async createOrUpdateFinding(t,e,a){let i=await r.query(o.AUDIT_FINDINGS,[(0,d.ar)("auditId","==",t),(0,d.ar)("questionId","==",e)]);i.length>0?await r.update(o.AUDIT_FINDINGS,i[0].id,a):await r.create(o.AUDIT_FINDINGS,{auditId:t,questionId:e,notes:"",evidenceNotes:"",timestamp:d.EK.now(),...a})}static async toggleQuestionOmission(t,e,a){let i=await r.query(o.OMITTED_QUESTIONS,[(0,d.ar)("auditId","==",t),(0,d.ar)("questionId","==",e)]);i.length>0?await r.delete(o.OMITTED_QUESTIONS,i[0].id):await r.create(o.OMITTED_QUESTIONS,{auditId:t,questionId:e,reason:a,omittedAt:d.EK.now()})}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),d=e.X(0,[276,972,686],()=>a(1628));module.exports=d})();